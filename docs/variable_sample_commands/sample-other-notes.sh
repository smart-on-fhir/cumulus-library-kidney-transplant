#!/bin/bash

start_time=$(date +%s)
echo "Process started at: $(date)"

# Other Notes
echo "Other Notes"
docker compose run --rm -it \
  cumulus-etl sample \
  <input folder with ndjson files from step 2 above> \
  --output ./samples/other-notes.csv\
  --export-to ./samples/other-notes/\
  --count 30 \
  --seed 07201869 \
  --columns "note,subject,encounter" \
  --phi-dir <your typical ETL PHI folder> \
  --athena-database <relevant_cumulus_library_database>  \
  --athena-workgroup <relevant_cumulus_library_workgroup> \
  --athena-region <relevant_cumulus_region> \
  --select-by-regex "^(?!.*(?:\bsuitable\ match\b|\bCadaveric\b|\bAdherence\b|\bD\-\b|\bdid\ not\ survive\b|\bPneumocystosis\b|\bRenal\ DD\b|\bsubtherapeutic\b|\bPTLD\b|\bKaposiâ€™s\b|\bSensitization\b|\bGrade\b|\bLymphoma\b|\binadequate\ level\b|\bGraft\b|\bCMV\-\b|\bCellulitis\b|\bViral\b|\bBacteremia\b|\bdoes\ not\ take\ meds\b|\bThrombosis\b|\bMycobacterium\b|\bOpportunistic\b|\bAcute\ cellular\b|\bantigen\ matches\b|\bFail\b|\brefuses\ medication\b|\bPCP\b|\bTransplant\ Date\b|\bDisfunction\b|\bSensitized\b|\bAbscess\b|\bBiopsy\b|\bfavorable\ match\b|\bre\-excise\b|\bgood\ level\b|\bColonization\b|\bRemoval\b|\bclose\ match\b|\bResistance\b|\btarget\ level\b|\bLymphomas\b|\bMelanomas\b|\bAntibody\ Mediated\b|\bChemotherapy\b|\bnondirected\ donor\b|\bDeceased\ Kidney\b|\bShock\b|\bhuman\ leukocyte\ antigen\b|\bEdema\b|\bDonor\b|\bseropositivity\b|\bVariant\b|\bSarcomas\b|\bHodgkin's\b|\bDysfunction\b|\bperfect\ match\b|\bDonor\ reactive\b|\bBaseline\b|\bnon\ functional\b|\bbelow\ level\b|\bCancers\b|\bOrgan\b|\bC\ diff\b|\bidentically\ matched\b|\bNon\-Melanoma\b|\bVirulence\b|\bRejected\b|\bB\-cells\b|\bLiving\ Donor\b|\bvolunteer\ donor\b|\bKaposi\b|\bpoor\ compliance\b|\bProliferative\b|\bPCR\b|\bat\ goal\b|\bPreemptive\b|\bProphylactic\b|\bPyelonephritis\b|\bseropositive\b|\bMycobacteria\b|\bAdheres\b|\bNeoplasm\b|\bInvades\b|\bSister\ donor\b|\bHLA\ Quality\b|\bEscherichia\b|\bB\-cell\b|\bfully\ matches\b|\bB\-lymphocytes\b|\bD\(\+\)\b|\bbelow\ target\b|\bYeast\b|\bDonor\(\+\)\b|\bInfectious\b|\bFumigatus\b|\bregularly\ taking\b|\bGram\-negative\b|\bGlomerulonephritis\b|\bDonor\ \(\+\)\b|\bEBV\+\b|\bStrain\b|\bAdenocarcinoma\b|\bpartial\ match\b|\bSibling\ donor\b|\bre\-excision\b|\bT\-cells\b|\bFailure\b|\bRecip\ \-\b|\bRenal\ vein\b|\bWatching\b|\bVesicoureteral\ Reflux\b|\bresected\b|\bE\ coli\b|\bSepticemia\b|\bVigilance\b|\bdirected\ donor\b|\bDonor\-negative\b|\bRejection\b|\bacceptable\ level\b|\bnon\-adherent\b|\btakes\ meds\b|\bSV40\b|\bDonor\ neg\b|\bAdhere\b|\boccasional\ missed\ doses\b|\binsufficient\ level\b|\bRecipient\ reactive\b|\bKlebsiella\b|\bpartial\ compliance\b|\bLDRT\b|\bDeceased\ Organ\b|\bfrequently\ misses\ doses\b|\bBKN\b|\bDonor\ pos\b|\bempirical\b|\bEmpiric\b|\bantigen\ match\b|\bnot\ at\ target\b|\bTrough\b|\bDonor\ nonreactive\b|\bR\(\-\)\b|\btherapeutic\b|\btarget\ range\b|\bHydronephrosis\b|\bincomplete\ compliance\b|\bSIRS\b|\bLive\ Renal\b|\bstable\ level\b|\bat\ target\b|\bpartial\ adherence\b|\bnot\ at\ goal\b|\babove\ level\b|\bInflammation\b|\bHCV\b|\bmismatched\b|\bUTD\b|\bD\ \+\b|\bimmunosuppressive\b|\bnon\ adherence\b|\badequate\ level\b|\bVigilant\b|\bCMV\b|\bfails\ to\ take\ meds\b|\bGraft\ Function\b|\bCarcinoma\b|\bEpstein\-Barr\b|\bLive\ Donor\b|\bacceptably\ matched\b|\bR\-pos\b|\bdied\b|\bImmunosuppression\b|\bFungemia\b|\bexcellently\ matched\b|\bgoal\ level\b|\bRecip\-\b|\bExit\ site\b|\bInfect\b|\bBK\ Virus\b|\btransplanted\ on\b|\bTCMR\b|\bFungus\b|\bMicroangiopathy\b|\bhigh\ mismatch\b|\bGoal\b|\bMicroorganism\b|\bT\ cells\b|\bInvasion\b|\bBiopsies\b|\bProliferated\b|\btakes\ meds\ irregularly\b|\bIschemia\b|\bserostatus\b|\bT\-lymphocytes\b|\bDonor\ \(\-\)\b|\bCancer\b|\bFamily\ donor\b|\bDD\ kidney\b|\bHLA\-A\b|\bPathogen\b|\bNeoplasia\b|\bNarrowing\b|\bidentical\ match\b|\bScreening\b|\bOversight\b|\bBKV\b|\burinary\ tract\ infection\b|\bAntibody\b|\bRecip\(\-\)\b|\bLive\ Kidney\b|\bDSAs\b|\bBiospecimen\b|\banonymous\ donor\b|\btransplant\s*\(?\d+\s*/\s*\d+\)?\b|\bTracking\b|\bB\-lymphocyte\b|\bPOD\b|\bfull\ match\b|\bnon\-compliant\b|\bweak\ match\b|\bNephritis\b|\bMonitoring\b|\bClostridium\b|\bpoor\ match\b|\bexcessive\ level\b|\bInfected\b|\bSurgical\ site\b|\bnon\-directed\ donor\b|\bMalignant\b|\bMelanoma\b|\bTubulitis\b|\bMycotic\b|\bunder\ level\b|\bliving\ unrelated\ donor\b|\bDDRT\b|\btakes\ medications\b|\bUreter\b|\bViremia\b|\bC\.\ diff\b|\bexcise\b|\bPeritoneal\b|\bRecip\ \+\b|\bWound\b|\babove\ range\b|\bT\-lymphocyte\b|\baltruistic\ donor\b|\bNoncompliant\b|\bEnteritis\b|\bRecip\ neg\b|\bGram\ staining\b|\bStrains\b|\bPneumonia\b|\bhistologic\b|\bR\ \(\+\)\b|\bFungal\b|\bHLA\-DQ\b|\bbelow\ range\b|\bE\.coli\b|\babove\ target\b|\bLRD\b|\bStreptococcus\b|\bTransplant\b|\bmoderately\ matched\b|\bIHC\b|\bExit\-site\b|\boccasionally\ misses\ doses\b|\bclosely\ matched\b|\bT\ cell\b|\bThrombotic\b|\bJirovecii\b|\bR\-\b|\bMetastatic\b|\bstopped\ taking\ meds\b|\bRecip\ \(\-\)\b|\bPathology\b|\bSpecimen\b|\bUreteritis\b|\brecipient\ serostatus\b|\bDonor\ \-\b|\bempirically\b|\bNeoplastic\b|\bnot\ compliant\b|\bAllograft\b|\bNephrectomy\b|\bLURD\b|\bNDD\b|\bKidney\ DD\b|\bScreen\b|\bVRE\b|\bHCV\+\b|\bHodgkin\b|\bGrading\b|\bFibrotic\b|\bFather\ donor\b|\bD\-pos\b|\bPathological\b|\bHighly\ Sensitized\b|\bE\.\ coli\b|\bdoes\ not\ take\ medications\b|\bEndocarditis\b|\bSurveillance\b|\bProliferate\b|\bDonor\(\-\)\b|\bSSI\b|\bMicrobial\b|\bBrother\ donor\b|\bPartially\ Compliant\b|\bACR\b|\bnot\ adherent\b|\bAntibiotics\b|\bsupra\ level\b|\bDonor\-\b|\bLevel\b|\bLymphoproliferative\b|\bDeath\b|\bsometimes\ compliant\b|\bEpstein\b|\bRecip\ \(\+\)\b|\bEBV\b|\bR\ \(\-\)\b|\bVirus\b|\bHBV\b|\bPJP\b|\bCompliance\b|\bD\ \(\+\)\b|\bSepsis\-like\b|\bColonized\b|\bgood\ samaritan\ donor\b|\bErythema\b|\bGram\-positive\b|\bHemodialysis\b|\bR\ \-\b|\bMycosis\b|\bD\-neg\b|\bRecip\(\+\)\b|\bfrequent\ missed\ doses\b|\bcadaver\b|\bT\ lymphocytes\b|\bRelated\ Donor\b|\bintermediate\ match\b|\bPathogenic\b|\bClostridioides\b|\bC\.diff\b|\bre\-excised\b|\bimmunostaining\b|\btaking\ medications\b|\bCatheter\b|\bInvaded\b|\bRecipient\ nonreactive\b|\bbolus\b|\bAllograft\ Function\b|\bSeptic\b|\bweakly\ matched\b|\bPeritonitis\b|\bBeating\ heart\b|\bCytomegalovirus\b|\bseronegative\b|\bFamilial\ donor\b|\bfully\ matched\b|\bD\(\-\)\b|\bWatch\b|\bHyperplasia\b|\bantigen\ matched\b|\bVUR\b|\bDialysis\b|\bpassed\ peacefully\b|\bPrevention\b|\bColonies\b|\bGraftectomy\b|\bpoorly\ matched\b|\bHepatitis\b|\bhighly\ mismatched\b|\bBKV\+\b|\bDonation\b|\bHyperplastic\b|\bVirulent\b|\bPreventive\b|\bdonor\ serostatus\b|\bColony\b|\bBrain\-dead\b|\bR\-neg\b|\bend\ of\ life\b|\bInfection\b|\bRenal\ artery\b|\bProphylaxis\b|\bAntimicrobial\b|\bpoor\ adherence\b|\bRecip\-positive\b|\bDesensitization\b|\bCdiff\b|\bHerpes\b|\bdead\b|\bHeart\ beating\b|\bmissed\ doses\b|\bKidney\ Function\b|\bCarcinomas\b|\bTarget\b|\bIgG\ negative\b|\bSepsis\b|\btaking\ regularly\b|\bKDIGO\b|\bDD\ donor\b|\bMonitor\b|\bZoster\b|\bpassed\ away\b|\bunder\ range\b|\bFibrosis\b|\bTrack\b|\bHLA\-DP\b|\bMalignancy\b|\bShingles\b|\bOversee\b|\bLRRT\b|\bGram\ stain\b|\bNHL\b|\bDesensitized\b|\bR\+\b|\bappropriate\ level\b|\bCompliant\b|\bVZV\b|\bPolymicrobial\b|\bDonor\-positive\b|\bEnterococcus\b|\bT\ lymphocyte\b|\bunder\ target\b|\bDD\ renal\b|\bAntibiotic\b|\bMold\b|\bDeceased\ Donor\b|\bD\+\b|\bfails\ to\ take\ medications\b|\bInvade\b|\bLiving\ Renal\b|\bmismatch\b|\bAspergillosis\b|\bimmunoglobulin\b|\bexcellent\ match\b|\bRecip\ pos\b|\bCandida\b|\bCandidiasis\b|\bB\ cells\b|\bTissue\b|\bNot\ Sensitized\b|\bHLA\-B\b|\bunfavorably\ matched\b|\bVaricella\b|\bperfectly\ matched\b|\bAlloimmunized\b|\bHSV\b|\bDSA\b|\bT\-cell\b|\btaking\ as\ prescribed\b|\bUnrelated\ donor\b|\bResection\b|\bBK\ Viral\b|\bR\(\+\)\b|\bB\ lymphocytes\b|\bChild\ donor\b|\bhigh\ level\b|\binconsistent\ adherence\b|\bHLA\-C\b|\belevated\ level\b|\bnonfunctional\b|\bGram\ positive\b|\bPurulence\b|\bLymphoproliferation\b|\bmismatches\b|\bmoderate\ match\b|\bpartially\ adherent\b|\bD\ \(\-\)\b|\bUTI\b|\bimmunosuppressant\b|\bAspergillus\b|\bAMR\b|\bgood\ match\b|\bHSV\+\b|\bDonor\ specific\b|\bGram\ negative\b|\bbelow\ goal\b|\bliving\ relative\b|\bAntigen\b|\bStricture\b|\bHLA\b|\bcompatible\ match\b|\binconsistent\ with\ meds\b|\bstaining\b|\bFailed\b|\bunfavorable\ match\b|\babove\ therapeutic\b|\bacceptable\ match\b|\bnot\ functioning\b|\bExplantation\b|\bIgG\ positive\b|\bover\ target\b|\bCLABSI\b|\bResistant\b|\bseronegativity\b|\bRecipient\b|\bNon\-hodgkin\b|\bunder\ goal\b|\bBiosample\b|\bsupratherapeutic\b|\bInflammatory\b|\bR\ \+\b|\bpartially\ match\b|\bPolyomaviridae\b|\btoxic\ level\b|\bHLA\-DR\b|\bCytotoxic\b|\bObstruction\b|\bMicrobe\b|\bRenal\ Function\b|\bRemoved\b|\bD\ \-\b|\bSarcoma\b|\babove\ goal\b|\bexcised\b|\bimmunostain\b|\bHBV\+\b|\bAntibodies\b|\bnon\ directed\ donor\b|\bStenosis\b|\bcomplete\ match\b|\bfavorably\ matched\b|\bLevels\b|\bimmunohistochemistry\b|\bIGG\b|\bDeceased\ Renal\b|\bRecip\+\b|\bBacterial\b|\bregularly\ takes\b|\bBacillus\b|\bProliferation\b|\bInfections\b|\bParent\ donor\b|\bwell\ matched\b|\bwithin\ range\b|\bAntibody\-Mediated\b|\bDonor\ \+\b|\bPNA\b|\bVZV\+\b|\bnow day\s*\+?\d+\b|\bDonor\+\b|\bMother\ donor\b|\bInflamed\b|\bPneumoniae\b|\bBrain\ dead\b|\bProliferating\b|\bIVIG\b|\bPurulent\b|\bRecip\-negative\b|\bintermittently\ compliant\b|\bCMV\+\b|\bLiving\ Kidney\b|\bstain\b|\bBacteria\b|\bPneumocystis\b|\bliving\ related\ donor\b|\bReject\b|\bBanff\b|\bB\ lymphocyte\b|\bB\ cell\b|\bnonfunctioning\b|\bcompletely\ matched\b|\btransplant\ on\b))" \
  --select-by-athena-table irae__sample_casedef_peri \
  --allow-large-selection

# Record end time
end_time=$(date +%s)
elapsed=$((end_time - start_time))

echo "Process finished at: $(date)"
echo "Total duration: $elapsed seconds"
