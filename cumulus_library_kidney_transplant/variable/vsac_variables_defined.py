from typing import List
from cumulus_library_kidney_transplant.variable.aspect import Variable, Valueset, Aspect, AspectMap
from cumulus_library_kidney_transplant.variable.aspect import Diagnoses, Medications, Labs, Procedures, Documents

###############################################################################
#
# Proc Procedures
#
###############################################################################
def get_procedures() -> Procedures:
    return Procedures([
        Variable('Transplant', {
            'kidney': ['2.16.840.1.113762.1.4.1078.16',
                       '2.16.840.1.113883.3.464.1003.109.12.1012'],
            'other_major': '2.16.840.1.113883.3.464.1003.198.12.1075',
            'solid_organ': '2.16.840.1.113762.1.4.1032.205',
            'stem_cell': '2.16.840.1.113762.1.4.1032.250',
            'recipient': '2.16.840.1.113762.1.4.1111.27'}),
        Variable('Dialysis', {
            'services': '2.16.840.1.113883.3.464.1003.109.12.1013'}),
        Variable('Nephrectomy', {
            'sct': '2.16.840.1.113762.1.4.1248.200',
            'icd10pcs': '2.16.840.1.113762.1.4.1248.4'})])

###############################################################################
#
# Doc Document
#
###############################################################################
def get_documents() -> Documents:
    return Documents([
        Variable('biopsy', {
            'kidney': '2.16.840.1.113762.1.4.1222.864',
            'skin': '2.16.840.1.113762.1.4.1222.867',
            'lung': '2.16.840.1.113883.3.1434.1011',
            'bone': '2.16.840.1.113762.1.4.1222.870',
            'muscle': '2.16.840.1.113762.1.4.1222.868',
        })])

###############################################################################
#
# Dx Diagnosis
#
###############################################################################
def get_diagnoses() -> Diagnoses:
    cancer_any = '2.16.840.1.113883.3.526.3.1010'
    vars = list()
    vars.append(Variable(
        'Transplant', {
            'kidney': ['2.16.840.1.113762.1.4.1078.16',
                       '2.16.840.1.113883.3.464.1003.109.11.1063',
                       '2.16.840.1.113883.3.464.1003.109.12.1012'],
            'solid_organ': '2.16.840.1.113762.1.4.1032.205',
            'stem_cell': ['2.16.840.1.113762.1.4.1032.221', '2.16.840.1.113762.1.4.1264.34'],
            'recipient': '2.16.840.1.113762.1.4.1111.27'}))
    vars.append(Variable(
        'Cancer', {
            # 'any' : cancer_any,
            'melanoma_malignant': ['2.16.840.1.113883.3.1434.1038', '2.16.840.1.113883.3.464.1003.108.11.1018'],
            }))
    vars.append(Variable(
        'Kidney', {
            'condition': '2.16.840.1.113883.17.4077.3.2028',
            'renal_disease': '2.16.840.1.113762.1.4.1029.335',
            'esrd': '2.16.840.1.113762.1.4.1235.172',
            'ckd': '2.16.840.1.113762.1.4.1078.114',
            'akf': '2.16.840.1.113762.1.4.1222.1534',
            'dialysis': '2.16.840.1.113762.1.4.1078.342',
            'nephrotic_syndrome': '2.16.840.1.113883.3.464.1003.109.12.1018'}))
    vars.append(Variable(
        'Autoimmune', {
            'inflammatory': '2.16.840.1.113883.3.3157.1834',
            'ibd': '2.16.840.1.113762.1.4.1078.879',
            'crohns': '2.16.840.1.113762.1.4.1034.576',
            'arthritis_ra': ['2.16.840.1.113762.1.4.1222.651', '2.16.840.1.113762.1.4.1222.81'],
            'lupus': '2.16.840.1.113883.3.464.1003.117.12.1010'}))
    vars.append(Variable(
        'immunocompromised', {
            'any': ['2.16.840.1.113883.3.666.5.1940', '2.16.840.1.113762.1.4.1235.212']}))
    vars.append(Variable(
        'Infection', {
            'bacterial': '2.16.840.1.113762.1.4.1200.288',
            'pna': '2.16.840.1.113762.1.4.1078.738',
            'cmv': ['2.16.840.1.113762.1.4.1146.2234', '2.16.840.1.113762.1.4.1146.2233'],
            'rsv': '2.16.840.1.113762.1.4.1078.754',
            'hsv': '2.16.840.1.113762.1.4.1146.1781',
            'influenza': '2.16.840.1.113762.1.4.1078.747',
            'shingles': '2.16.840.1.113762.1.4.1222.1478',
            'hepatitis_b': '2.16.840.1.113883.3.464.1003.110.12.1025',
            'hepatitis_c': '2.16.840.1.113762.1.4.1222.30'}))
    return Diagnoses(vars)

###############################################################################
#
# Lab Laboratory Observations
#
###############################################################################
def get_labs() -> Labs:
    # return get_lab_analytes()
    panels = get_lab_panels()
    analytes = get_lab_analytes()
    return Labs(panels.variable_list + analytes.variable_list)

def get_lab_panels() -> Labs:
    return Labs([
        Variable('CBC',
                 {'with_diff': '1.3.6.1.4.1.6997.4.1.2.271.13.38167.1.1.999.594'}),
        Variable('CMP', {'comprehensive': '2.16.840.1.113762.1.4.1078.867'}),
        Variable('GFR', {'egfr': ['2.16.840.1.113883.3.6929.3.1000',    # Active gold standard maintainer
                                  '2.16.840.1.113762.1.4.1222.179',
                                  '2.16.840.1.113762.1.4.1078.397',
                                  '2.16.840.1.113762.1.4.1235.81']}),
        Variable('LFT', {
            'function': '2.16.840.1.113762.1.4.1078.867',
            'ggt': '2.16.840.1.113762.1.4.1222.806',
            'pt': '2.16.840.1.113883.3.3616.200.110.102.5037',
            'inr': '2.16.840.1.113883.3.117.1.7.1.213'})])

def get_lab_analytes() -> Labs:
    return Labs([
        Variable('Creatinine', {
            'serum_cr': '2.16.840.1.113762.1.4.1146.2206',
            'blood_cr': '2.16.840.1.113762.1.4.1222.111',
            'urine_cr': '2.16.840.1.113762.1.4.1178.87',
            'urine_alb_cr_ratio': '2.16.840.1.113883.3.6929.3.1007',
            'urine_protein_cr_ratio': '2.16.840.1.113762.1.4.1222.790',
            'cystatin_c': '2.16.840.1.113762.1.4.1222.138'}),
        Variable('Autoimmune', {
            'serum_rf': '2.16.840.1.113762.1.4.1222.812',       # rf= Rheumatoid Factor
            'blood_esr': '2.16.840.1.113762.1.4.1222.1609',     # esr= Erythrocyte Sedimentation Rate
            'crp': '2.16.840.1.113762.1.4.1146.1933',           # crp= C Reactive Protein
            'tsh': '2.16.840.1.113762.1.4.1146.2156',           # tsh= Thyroid Stimulating Hormone
            't3': '2.16.840.1.113762.1.4.1078.864',             # t3= Triiodothyronine
            't4': '2.16.840.1.113762.1.4.1078.865'}),           # t4 = Thyroxine
        Variable('Diabetes', {
            'screening': '2.16.840.1.113762.1.4.1221.122',
            'glucose_test': '2.16.840.1.113762.1.4.1045.134'
        })
    ])

###############################################################################
#
# Rx Medications
#
###############################################################################
def get_medications() -> Medications:
    return Medications([
        Variable('immunosuppressive', {
            'drugs': '2.16.840.1.113762.1.4.1219.192',
            'systemic_therapy': '2.16.840.1.113883.3.666.5.803',
            'immune_modulators': '2.16.840.1.113762.1.4.1248.124',
            'coricosteroids_systemic': '2.16.840.1.113883.3.3616.200.110.102.2061'}),
        Variable('cancer', {
            'chemo_advanced': '2.16.840.1.113883.3.7643.2.1046',
            'checkpoint': '2.16.840.1.113883.3.1444.5.231',
            'keytruda': '2.16.840.1.113762.1.4.1260.496',
            'ade_neutropenia': '2.16.840.1.113883.3.526.3.1538'}),
        Variable('antibiotics', {
            'any': '2.16.840.1.113762.1.4.1078.849',
            'systemic': '2.16.840.1.113762.1.4.1133.6'}),
        Variable('diabetes', {'drugs': '2.16.840.1.113762.1.4.1190.58'}),
        Variable('HTN', {'drugs': '2.16.840.1.113883.3.600.1476'}),
        Variable('Diuretics', {
            'loop': '2.16.840.1.113762.1.4.1078.898',
            'potassium': '2.16.840.1.113762.1.4.1213.41',
            'thiazide': '2.16.840.1.113762.1.4.1078.8'})])

###############################################################################
#
# Deprecated - maybe return to these later?
#
###############################################################################
def deprecated() -> List[Variable]:
    return [
        Variable('immunocompromised', {'therapies': '2.16.840.1.113762.1.4.1235.212'}),
        Variable('SurgeryOther', {'surgical_cohort': '2.16.840.1.113762.1.4.1182.127'}),
        Variable('Encounter', {'type': '2.16.840.1.113762.1.4.1267.23'}),
        Variable('drug_names', {
            'ingredient': '2.16.840.1.113762.1.4.1010.7',
            'brand': '2.16.840.1.113883.3.88.12.80.16',
            'prescribable_generic': '2.16.840.1.113883.3.88.12.80.17',
            'prescribable': '2.16.840.1.113762.1.4.1237.18'}),
        Variable('ADE', {
            'common_reactant': '2.16.840.1.113762.1.4.1010.1',
            'common_allergy_intolerance': '2.16.840.1.113762.1.4.1186.8'}),
        Variable('cancer', {
            'systemic': '2.16.840.1.113762.1.4.1260.101',
            'any': '2.16.840.1.113762.1.4.1260.230'}),
        Variable('ObservationInterpretation', {
            'any': '2.16.840.1.113883.1.11.78',
            'abnormal': ['2.16.840.1.113762.1.4.1146.295', '2.16.840.1.113762.1.4.1181.56'],
            'low': '2.16.840.1.113762.1.4.1146.2019',
            'high': '2.16.840.1.113762.1.4.1146.2018'
        }),
        Variable('Cancer', {
            'malignant_melanoma_sct': '2.16.840.1.113883.3.1434.1038',
            'malignant_melanoma_icd10': '2.16.840.1.113883.3.464.1003.108.11.1018'}),
        Variable('Heart', {
            'cardiomyopathy': '2.16.840.1.113762.1.4.1222.579',
            'attack': '2.16.840.1.113883.3.666.5.3011',
            'failure': '2.16.840.1.113762.1.4.1222.1543',
            'cohort': '2.16.840.1.113762.1.4.1182.308'}),
        Variable('HTN', {
            'essential': '2.16.840.1.113883.3.464.1003.104.12.1011',
            'any': '2.16.840.1.113762.1.4.1251.12',
            'hypertensive_ckd': '2.16.840.1.113883.3.464.1003.109.12.1017'}),
        Variable(
        'Diabetes', {
            'pre': '2.16.840.1.113762.1.4.1078.450',
            't1d': '2.16.840.1.113762.1.4.1078.215',
            't2d': '2.16.840.1.113762.1.4.1160.29',
            't2d_related_dx': '2.16.840.1.113762.1.4.1078.440',
            'disorder': '2.16.840.1.113762.1.4.1219.35',
            'preexisting': '2.16.840.1.113762.1.4.1029.275',
            'complications': '2.16.840.1.113762.1.4.1222.1537',
            'nafld': '2.16.840.1.113762.1.4.1222.770',
            'retinopathy': '2.16.840.1.113883.3.526.3.327',
            'nephropathy': '2.16.840.1.113883.3.464.1003.109.12.1004',
            'ckd': '2.16.840.1.113762.1.4.1078.124'})]

def get_aspect_map() -> AspectMap:
    return AspectMap(
        diagnoses=get_diagnoses(),
        medications=get_medications(),
        labs=get_labs(),
        procedures=get_procedures(),
        documents=get_documents())
